# ⛓️ Running a Script Node

## Introduction

Nodes are used to run blockchain applications and to validate and store the complete history of transactions on the blockchain network. Within the SCRIPT network, the P2P protocol allows nodes to communicate with one another and transfer information about new blocks and transactions. Each node on the SCRIPT blockchain can store a complete copy of the distributed ledger. Thanks to the blockchain nodes, any user can access the data and view all transactions conducted or stored on the network.

Moreover, each new node contributes to the decentralization of the blockchain network, minimizing the transaction time and lowering fees. By setting up your node, you receive a small income from the transactions that go through your channels.

```
Nodes participate in consensus, share information about transactions and the number of funds, confirm transactions and store copies of confirmations, and participate in building new blocks in the chain, for which they receive a reward.

```

``Validator Nodes:`` These nodes are the foundation of the SCRIPT blockchain, proposing blocks for the blockchain and approving transactions in the network. One node must have 5,000,000 (5M) SCPT tokens staked to become a valid Validator Node and participate in the network.

``Script Edge Nodes:`` Edge Nodes are a critical infrastructure component of the Script Network and Protocol. They are responsible for retrieving content from other Edge Nodes and distributing it to end users.

``Lightning Nodes:`` These nodes are secondary layer nodes in the SCRIPT blockchain network. They validate each block, verifying these blocks are free of malicious activity or data. One node must have at least 10,000 (10k) tokens to become a Lightning node.

Both Validators and Lightnings are paid a fee for verifying transactions. Each Validator can get a share of tokens for each block, and among the Lightnings, the recipient of the reward for each block will be selected randomly. If malicious behavior is detected, Script Network will penalize the network participant/s by deducting tokens from their token rewards. The node that detects the malicious behavior sends the slash transaction to the blockchain, and the held penalty tokens will be awarded to the node that sent the slash transaction first.

``Lightning Node Pool:`` The Lightning node pool will comprise a large number of nodes anywhere into the thousands. The Lightnings examine and check the chain of blocks generated by the Validators. Any node in the network can become a Lightning provided they lock a certain number of tokens for some time (once again, up-to-date figures for these requirements will be found at https://token.script.tv). If a Lightning pool has reached consensus on a block, this block becomes finalized in the ‘block finalization process’.

### Script Node Functionalities

Script node runs on top of IFPS and stores data like video content in the network in a decentralized way. Script node allows end-users to contribute their computing power for network storage and partially alleviate SCRIPT servers of transcoding work. For their contributions, users will receive token rewards.

```
Note: While the Script node is isolated from the Script blockchain network, they remain programmatically connected via wallet APIs. Any user can be provided with the Script node software. This software can be efficiently run on almost any device irrespective of its operating system, and Script node operation can begin immediately after successful activation.
```

### How To Activate Script Node?

To begin an activation, users must link their wallet address to the node. To achieve the maximum reduction in data transmission distance without compromising the quality of service (QoS), each segment can be cached in different Script nodes. The most ping optimal Script nodes will be automatically recommended to viewers. Nodes that transfer cached data are rewarded with SPAY tokens. The script, in turn, will use a selection algorithm to find the nearest neighboring nodes that can transmit data with the best speed and quality. Within an off-chain micropayment system, a user can create an off-chain micropayment that any other user can accept.

## Setup

This script is designed to install and build the Script4 node on your local machine. It provides a convenient way to set up the necessary dependencies, install Go, build the Script4 source code, and install the compiled binary either in your home directory or system-wide.

To learn more about the Script Network in general, please visit the **Script Documentation site**: https://whitepaper.script.tv/.

### Prerequisites

Before running this script, ensure that you have the following:
1. A Unix-based operating system (e.g., Linux, macOS)
2. Root or sudo privileges (for some commands)

### Usage

The script can be executed with different arguments to perform specific tasks. Run the script with the `--help` or no argument to display the usage instructions:

```
./install_script4_node.sh [--help]
```

### Available Commands

```
install_deps: Install build dependencies (requires sudo)
install_go: Install Go programming language
build: Build the Script4 source code
install_home: Install Script4 in your home directory (no sudo required)
install_system: Install Script4 in the system-wide directory /usr/local (requires sudo)
```

### Examples

#### Install build dependencies (requires sudo):

```
sudo ./install_script4_node.sh install_deps
```

#### Install Go:

```
./install_script4_node.sh install_go
```

#### Build Script4:

```
./install_script4_node.sh build
```

#### Install Script4 in your home directory (no sudo required):

```
./install_script4_node.sh install_home
```

#### Install Script4 in the system-wide directory /usr/local (requires sudo):

```
sudo ./install_script4_node.sh install_system
```

## Script Details

The script performs the following tasks:

1. Installs build dependencies (build-essential, git, brew, tmux, mingw-w64) on your local machine.
2. Downloads and installs the Go programming language on your local machine.
3. Clones the Script4 repository from GitHub and builds the source code.
4. Installs the compiled Script4 binary either in your home directory or the system-wide directory `/usr/local`, depending on the chosen command.

## Contributions

Contributions to this script are welcome! If you find any issues or have suggestions for improvements, please open an issue or submit a pull request on the project's repository.

## Command Line Tool 

The Script ledger software provides a command line wallet tool scriptcli for users to interact with the Script ledger. Below is an example of sending tokens between two addresses.

### Send and Receive Tokens 

After building the Script ledger, two binaries script and scriptcli are generated. Script can be regarded as the launcher of the script Ledger node, and scriptcli is a wallet with command line tools to interact with the ledger. We can use the scriptcli command line tool to send Script tokens from one address to another by executing the following command. Open a terminal, and execute the following command. When the prompt asks for password, enter your password.

```sh
scriptcli tx send --chain="scriptnet" --from= 98fd878cd2267577ea6ac47bcb5ff4dd97d2f9e5 --to=9F1233798E905E173560071255140b4A8aBd3Ec6 --script=0 --spay=20 --seq=1
```

The balance of an address can be retrieved with the following query command, after the transaction has been included in the blockchain (may take a couple seconds).

```sh
scriptcli query account --address=9F1233798E905E173560071255140b4A8aBd3Ec6
```
Now let us send 20 more Script tokens. Note that we need to increment the seq parameter to 2. The seq parameter is a transaction counter for each account, similar to the nonce parameter for Ethereum transactions. Each time we send tokens from an account, we need to increment the seq by 1.

```sh
scriptcli tx send --chain="scriptnet" --from=98fd878cd2267577ea6ac47bcb5ff4dd97d2f9e5 --to=9F1233798E905E173560071255140b4A8aBd3Ec6 --script=0 –spay=20 --seq=2
```

We can query the recipient address again to verify the account balance changes.

```sh
scriptcli query account --address=9F1233798E905E173560071255140b4A8aBd3Ec6
```

## Steps to Upgrade the Chain 

1. Login and switch to node directory
```sh
cd /usr/local/go/src/github.com/scripttoken/script
```
2. Pull the latest code from the repository and check out the main branch.
```sh
git fetch
git checkout main
git pull
```
3. Compile the code
```sh
cd /usr/local/go/src/github.com/scripttoken/script 
make install
```
4. Terminate the running blockchain node in background process whether it is in tmux, nohup, sceen, pm2 or other, and then run the code.
```sh
cd /usr/local/go/src/github.com/scripttoken/script
/usr/local/go/bin/script start --config=../scriptnet/node 
```

Enter the password when prompted.

## Account/Wallet Management 

The Script command line tool can be used as a wallet, which can manage multiple accounts with the keys encrypted. Below are the relevant commands

* ```scriptcli key new``` Creates a new account with a password. The newly created key is encrypted and stored under ~/.scriptcli/keys/encrypted/ by default.
* ```scriptcli key list``` List all the accounts managed by the wallet.
* ```scriptcli key password``` Resets the password for the account. You will need the current password for the reset.
* ```scriptcli key delete``` Deletes the account. You will need the password for the account for the deletion.

## Call Smart Contract 

This API simulates the smart contract execution locally without submitting the smart contract transaction to the blockchain. It is useful to evaluate the execution result, calculate the gas cost, etc.

**RPC Method:** 
script.CallSmartContract
**Query Parameters:**
sctx_bytes: the signed transaction bytes
**Returns:**
vm_return: the return of the virtual machine
contract_address: the address of the corresponding smart contract
gas_used: amount of gas used for the smart contract execution
vm_error: error returned by the virtual machine if any

## Turing-Complete Smart Contract Support 

Turing-complete smart contracts open the door to numerous use cases in video streaming and beyond, from token investments in streamers, to automated splits of SCPT rewards between platform/streamers/users, to non-fungible tokens (NFTs) representing top content creators. 

Since the Script Virtual Machine is compatible with Ethereum Virtual Machine (EVM), porting over existing Ethereum-based contracts is simple and thousands of smart contract developers can easily jump to building on Script. Between the Script Labs team and Script community, many projects are already in the works including decentralized exchanges (DEXs), staking pools, and more.

Since the Script Virtual Machine is compatible with EVM, a developer can compile the [Solidity](https://docs.soliditylang.org/en/v0.7.5/) contract source code using his preferred compiler toolchain ([Remix](https://remix.ethereum.org/), [Truffle](https://www.trufflesuite.com/), or [solc](https://docs.soliditylang.org/en/v0.7.5/installing-solidity.html)) into bytecode and then deploy to the Script Blockchain.

A user can deploy and interact with the smart contract either manually through the Script Web Wallet or programmatically via the Script Blockchain SDK. Also note that on the Script Blockchain, SCPT takes the place of ETH in all contracts. Just as you need ETH to deploy or interact with smart contracts on Ethereum, you need SCPT to do so on Script blockchain. All SCPT used to deploy or interact with smart contracts is burned.